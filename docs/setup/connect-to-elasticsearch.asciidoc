[[connect-to-elasticsearch]]
== 连接 Kibana 和 Elasticsearch

开始使用 Kibana 前 ，需要告诉 Kibana 你想要探索的 Elasticsearch 索引 。
第一次访问 Kibana 时 ，会提示你定义一个 _index pattern_ 匹配
一个或多个索引 。这就是初次使用 Kibana 时所有需要配置的 。任何时候都可以在
 <<settings-create-pattern,Management tab>> 增加索引模式 。

TIP: By default, Kibana connects to the Elasticsearch instance running on `localhost`. To connect to a
different Elasticsearch instance, modify the Elasticsearch URL in the `kibana.yml` configuration file and
restart Kibana. For information about using Kibana with your production nodes, see <<production>>.

设置你想通过 Kibana 访问的 Elasticsearch 索引 ：

. 浏览器中指定端口号 5601 来访问 Kibana UI 页面 。例如 ， `localhost:5601` 或者
`http://YOURDOMAIN.com:5601`.
+
image:images/Start-Page.png[Kibana start page]
+
. 指定一个索引模式来匹配一个或多个 Elasticsearch 索引名称。默认情况下 ，
Kibana 会认为数据是通过 Logstash 灌进 Elasticsearch 的。如果是这种情况 ，
可以使用默认的 `logstash-*` 作为索引模式 。 星号 (*) 匹配 0 或多个
索引名称中的字符 。如果 Elasticsearch 索引遵循其他命名约定 ，输入
一个恰当的模式 。 "pattern" 可以仅仅是索引的名字这么简单 。
. 选择索引字段中包含时间戳的 ，可以用来作基于时间的比较 。
Kibana 读取索引 mapping ，列出包含时间戳的所有字段 。如果索引
中没有基于时间的数据 ，禁用 *Index 包含 time-based events* 选项 。
+
WARNING: Using event times to create index names is *deprecated* in this release of Kibana. Support for
this functionality will be removed entirely in the next major Kibana release. Elasticsearch 2.1 includes
sophisticated date parsing APIs that Kibana uses to determine date information, removing the need to
specify dates in the index pattern name.
+
. 点击 *Create* 增加索引模式 。默认情况下 ，第一个模式自动设置 。
当索引模式不止一个时 ，可以通过点击 *Management > Index Patterns* 索引模式题目上的 
星来指定默认的索引模式 。

全部设置完毕 ! Kibana 连接到了 Elasticsearch 数据 。Kibana 展示了一个匹配到的索引字段的只读列表 。

NOTE: Kibana relies on dynamic mapping to use fields in visualizations and manage the
`.kibana` index. If you have disabled dynamic mapping, you need to manually provide
mappings for the fields that Kibana uses to create visualizations. For more information, see
<<kibana-dynamic-mapping, Kibana and Elasticsearch Dynamic Mapping>>.

[float]
[[explore]]
=== 开始探索你的数据 ！
准备号挖掘你的数据 ：

* 在 <<discover, Discover>> 页搜索和浏览数据 。
* 在 <<visualize, Visualize>> 页作图和映射数据 。
* 在 <<dashboard, Dashboard>> 页创建并查看自定义 dashboard 。

关于一步步介绍 Kibana 主要概念的信息 ，查看 <<getting-started,
Getting Started>> 帮助 。

[float]
[[kibana-dynamic-mapping]]
=== Kibana 和 Elasticsearch 动态 Mapping
默认情况下 ， Elasticsearch 启用了字段的 {es-ref}dynamic-mapping.html[dynamic mapping] 。Kibana 需要
动态 mappings 来在可视化控件中正确使用字段 ，同样地管理 `.kibana` 索引 ，这些索引存储了
保存的搜索 、可视化图表和 dashboards 。

如果 Elasticsearch 使用案例禁止动态 mapping ，这就需要手动提供创建可视化控件所需要字段的 visualizations 的动态 mappings ，并手动启用 `.kibana` 索引的动态 mapping 。

下面的步骤假定 Elasticsearch 中不存在索引 `.kibana` ，
`elasticsearch.yml` 中 `index.mapper.dynamic` 的设置为 `false`:

. 启动 Elasticsearch
. 创建 `.kibana` 索引 ，动态 mapping ，该 mapping 只适用于该索引：
+
[source,shell]
PUT .kibana
{
  "index.mapper.dynamic": true
}
+
. 启动 Kibana ，转到 web 页面 ，确认没有动态 mapping 的错误 。
